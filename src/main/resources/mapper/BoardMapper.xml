<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sprint.nangpa.mapper.BoardMapper">

    <!-- 게시글 저장 -->
    <insert id="insertBoard" parameterType="com.sprint.nangpa.dto.board.BoardRegDTO" useGeneratedKeys="true" keyProperty="id">
    <![CDATA[
        INSERT
          INTO BOARD
               ( RECIPE_ID
               , EMAIL
               , CONTENT
               )
        VALUES ( #{recipeId}
               , #{email}
               , #{content}
               )
    ]]>
    </insert>

    <!-- 게시글 이미지 저장 -->
    <insert id="insertMoardImg" parameterType="com.sprint.nangpa.model.BoardImg">
    <![CDATA[
        INSERT
          INTO BOARD_IMG
               ( BOARD_ID
               , SORT_NO
               , IMG
               )
        VALUES ( #{boardId}
               , #{sortNo}
               , #{img}
               )
    ]]>
    </insert>

    <!-- 게시글 목록 조회 -->
    <select id="selectBoardInfoList" resultType="com.sprint.nangpa.dto.board.BoardInfoDTO">
    <![CDATA[
        SELECT A.ID
             , A.EMAIL
             , A.RECIPE_ID
             , A.CONTENT
             , B.NICKNAME
             , B.IMG_URL
          FROM BOARD A  INNER JOIN USER B   ON A.EMAIL = B.EMAIL
    ]]>
    </select>
    <select id="selectBoardImg" parameterType="Long" resultType="String">
    <![CDATA[
        SELECT IMG
          FROM BOARD_IMG
         WHERE BOARD_ID = #{boardId}
        ORDER BY
            SORT_NO
    ]]>
    </select>

    <!-- 게시글 수정 -->
    <update id="updateBoard" parameterType="com.sprint.nangpa.dto.board.BoardModDTO">
    <![CDATA[
        UPDATE BOARD
           SET CONTENT       = #{content}
             , MODIFIED_DATE = NOW()
         WHERE ID      = #{id}
    ]]>
    </update>

</mapper>